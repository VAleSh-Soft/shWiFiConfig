<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type" />
    <meta name="VIEWPORT" content="width=device-width, initial-scale=1.0" />
    <style>
      input,
      select {
        margin-left: 10px;
        margin-bottom: 3px;
        margin-right: 7px;
        display: block;
        width: 200px;
        -webkit-box-sizing: content-box;
        -moz-box-sizing: content-box;
        -ms-box-sizing: content-box;
        box-sizing: content-box;
      }
    </style>
  </head>
  <body>
    <script>
      function checkSsidValue(input_id) {
        if (
          document.getElementById(input_id).value.length < 8 ||
          document.getElementById(input_id).value.length > 32
        ) {
          alert(
            "Длина SSID должна быть не менее 8 и не более 32 символов! \n\n Разрешенные символы: 0-9, A-Z, a-z, - , _"
          );
          document.getElementById(input_id).focus();
          return false;
        }
        return true;
      }
      function checkPassValue(input_id) {
        if (document.getElementById(input_id).value.length < 8) {
          alert(
            "Длина пароля должна быть не менее 8 символов! \n\n Не разрешаются символы кириллицы и пробелы"
          );
          document.getElementById(input_id).focus();
          return false;
        }
        return true;
      }
      function validate_form() {
        // проверка данных
        if (
          checkSsidValue("ssid_ap") == false ||
          checkPassValue("ap_pass") == false ||
          checkSsidValue("ssid") == false ||
          checkPassValue("pass") == false
        ) {
          return false;
        }
        return true;
      }
      function btnSaveEnable() {
        document.getElementById("btn_save").removeAttribute("disabled");
      }
    </script>
    <div>
      <h3>Настройки сети</h3>
      <h4>Точка доступа</h4>
      <label>
        <input
          type="text"
          name="ssid_ap"
          id="ssid_ap"
          placeholder="имя своей точки доступа"
        />Имя точки доступа</label
      >
      <br />
      <label>
        <input
          type="text"
          name="ap_pass"
          id="ap_pass"
          placeholder="пароль своей точки доступа"
        />Пароль</label
      >
      <h4>Внешняя WiFi-сеть</h4>
      <label>Имя сети</label>
      <select name="ssid" id="ssid">
        <option>qqqq</option>
        <option selected>wwww</option>
      </select>
      <br />
      <label>Пароль</label>
      <input
        type="text"
        name="pass"
        id="pass"
        placeholder="пароль внешней сети"
      />
      <br />
    </div>
    <br />
    <input type="submit" id="btn_save" value="Сохранить" disabled />
    <script>
      function getConfig() {
        var request = new XMLHttpRequest();
        request.open("GET", "/getconfig", true);
        request.onload = function () {
          if (request.readyState == 4 && request.status == 200) {
            var config_str = request.responseText;
            var doc = JSON.parse(config_str);
            document
              .getElementById("ssid_ap")
              .setAttribute("value", doc.ssid_ap);
            document
              .getElementById("ap_pass")
              .setAttribute("value", doc.ap_pass);
            document.getElementById("ssid").setAttribute("value", doc.ssid);
            document.getElementById("pass").setAttribute("value", doc.pass);
          }
        };
        request.send();
      }

      document.getElementById("ssid_ap").addEventListener("keyup", function () {
        this.value = this.value.replace(/[^a-zA-Z0-9_/-]/g, "");
      });
      document.getElementById("ssid").addEventListener("keyup", function () {
        this.value = this.value.replace(/[^a-zA-Z0-9_/-]/g, "");
      });
      document.getElementById("ap_pass").addEventListener("keyup", function () {
        this.value = this.value.replace(/[А-Яа-яёЁ/ ]/g, "");
      });
      document
        .getElementById("ssid_ap")
        .addEventListener("input", btnSaveEnable);
      document
        .getElementById("ap_pass")
        .addEventListener("input", btnSaveEnable);
      document.getElementById("ssid").addEventListener("input", btnSaveEnable);
      document.getElementById("pass").addEventListener("input", btnSaveEnable);
      document.addEventListener("DOMContentLoaded", getConfig);
    </script>
  </body>
</html>
